AnimationCreator.define(["jQuery","underscore","Backbone","CanvasView","CanvasModel","Tools","Tool","renderTemplate","hbs!templates/main"],function(e,t,n,r,i,s,o,u,a){var f=n.View.extend({className:"animation-creator-main",tagName:"div",workerURI:"js/utils/worker.js",initialize:function(){var e=this;this.SubProcess=new Worker(this.workerURI),this.el.setAttribute("id",this.model.get("id"));var t=this.model.get("mainTemplateConfig"),n={target:t.mainAxis};this.mainAxis=o("MainAxes",n),this.tools=new s({model:this.model}),this.render(),this.tools.collection.add([o("Button",{attributes:{type:"button"},innerHTML:"generate css",onclick:function(){e.generateCSS()}}),o("Button",{attributes:{type:"button"},innerHTML:"print css",onclick:function(){e.printCSS()}})])},addInitialTools:function(){},events:function(){function t(t){switch(t.data.type){case"generateCSS":e.processCSS(t.data.data);break;case"error":console.log("the worker returned an error"),console.log(t);break;default:throw new Error("no handled response type")}}var e=this;this.SubProcess.addEventListener("message",t),this.mainAxis.model.on("change:transformations",function(){e.model.set("transformations",arguments[0])});var n=new Object;return n},render:function(){var e=this.model.get("mainTemplateConfig"),t=u(a,e);return this.$el.html(t),this.model.get("target").html(this.el),document.getElementById(e.mainAxis).appendChild(this.mainAxis.render()),document.getElementById(e.tools).appendChild(this.tools.render()),this.loadIcon=document.getElementById(e.loadIcon),this.styleSheet=document.getElementById(e.styleSheet),this.styleSheetHelper=document.getElementById(e.styleSheetHelper),this.queryElement=document.getElementById(e.queryElement),null},generateCSS:function(){var t={message:"generateCSS",workerData:{transformations:this.model.get("transformations")}};e("#test").removeClass("animate"),e(this.queryElement).removeClass("animation-creator-query"),this.spinerIcon.on.call(this),this.SubProcess.postMessage(t)},processCSS:function(t){return this.styleSheet.innerHTML=t[0],this.styleSheetHelper.innerHTML=t[1],this.spinerIcon.off.call(this),e("#test").addClass("animate"),e(this.queryElement).addClass("animation-creator-query"),null},printCSS:function(){return document.getElementById("text").innerHTML=this.styleSheet.innerHTML},query:function(){var t=parseFloat(e(this.queryElement).css("opacity")),n=(t.toFixed(4)*100).toPrecision(4),r=((t.toFixed(4)*100).toPrecision(4)/100).toPrecision(4),r=parseFloat(r);if(this.styleSheet.innerHTML.match(n))return n;throw new Error("failed query "+n)},play:function(e){return null},stop:function(){return null},overdub:function(){return null},multiplyMatrix2D:function(e,t){return[e[0]*t[0]+e[1]*t[2],e[0]*t[1]+e[1]*t[3],e[2]*t[0]+e[3]*t[2],e[2]*t[1]+e[3]*t[3],e[4]+t[4],e[5]+t[5]]},multiplyMatrix3D:function(e,t){return[e[0]*t[0]+e[1]*t[4],e[0]*t[1]+e[1]*t[5],0,e[3]+t[3],e[4]*t[0]+e[5]*t[4],e[4]*t[1]+e[5]*t[5],0,e[7]+t[7],0,0,1,0,e[12]+t[12],e[13]+t[13],0,e[15]+t[15]]},spinerIcon:{on:function(){e(this.loadIcon).addClass("animation-creator-loading")},off:function(){e(this.loadIcon).removeClass("animation-creator-loading")}}});return f});